@inherits LayoutComponentBase
@inject IYouTrackService _youTrackService
@inject IAzureDevOpsService _azureDevOpsService

<header class="py-2 shadow bg-white">
    <div class="container text-center">
        <h1 class="display-6 m-0"><a href="/" class="text-decoration-none">Werk</a></h1>
        <p class="m-0"><i>@(_youTrackUser is null ? "..." : $"Personalized for {_youTrackUser.FullName}!")</i></p>
    </div>
</header>

<main class="container my-3">
    @Body
</main>

<footer class="bg-white shadow py-3">
    <div class="container text-center">
        <p class="text-muted">
            <span title="@GetIntegrationTitle(_youTrackServiceStatus)" class="@GetIntegrationClass(_youTrackServiceStatus)">YouTrack</span>
            &nbsp;&bull;&nbsp;
            <span title="@GetIntegrationTitle(_azureDevOpsServiceStatus)" class="@GetIntegrationClass(_azureDevOpsServiceStatus)">Azure DevOps</span>
            &nbsp;&bull;&nbsp;
            <span title="@GetIntegrationTitle(WerkServiceStatus.Disabled)" class="@GetIntegrationClass(WerkServiceStatus.Disabled)">Microsoft TFS</span>
        </p>
    </div>
</footer>

@code{
    private WerkServiceStatus _youTrackServiceStatus;

    private WerkServiceStatus _azureDevOpsServiceStatus;

    private YouTrackUser _youTrackUser;

    protected override async Task OnInitializedAsync()
    {
        _youTrackServiceStatus = await _youTrackService.GetStatus();
        _azureDevOpsServiceStatus = await _azureDevOpsService.GetStatus();

        if (_youTrackServiceStatus == WerkServiceStatus.Ready)
        {
            _youTrackUser = await _youTrackService.FetchMe();
        }
    }

    private string GetIntegrationClass(WerkServiceStatus serviceStatus) => serviceStatus switch
    {
        WerkServiceStatus.Ready => "text-success",
        WerkServiceStatus.NotReady => "text-danger",
        _ => "text-muted"
    };

    private string GetIntegrationTitle(WerkServiceStatus serviceStatus) => serviceStatus switch
    {
        WerkServiceStatus.Ready => "Integration is ready",
        WerkServiceStatus.NotReady => "Integration is NOT ready, check config",
        _ => "Disabled"
    };
}